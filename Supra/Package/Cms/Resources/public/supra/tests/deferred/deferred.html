<!DOCTYPE html>
<html>
<head>
	<title>Deferred tests</title>
	<script type="text/javascript" src="../../../yui.3.5.0/build/yui/yui-min.js"></script>
	<script type="text/javascript" src="../../../yui.3.5.0/build/loader/loader.js"></script>
	<script type="text/javascript" src="../../build/supra/supra.js"></script>
	<script type="text/javascript" src="../../build/supra/data.js"></script>
	<script type="text/javascript" src="../../build/supra/modules.js"></script>
</head>
<body class="yui3-skin-supra">

	<script type="text/javascript">
	//<![CDATA[
	
		Supra('console', 'test', 'dump', function (Y) {
			
			// Set up the page
	        var ASSERT = Y.Assert;
	       	
	        var testBasic = new Y.Test.Case({
	            name: 'Deferred',
	            
	            testResolve: function () {
	            	
	            	var deferred = Supra.Deferred(),
	            		done = 100,
	            		fail = 100;
	            	
	            	deferred.done(function (str, num) {
	            		done++;
	            		
	            		ASSERT.areEqual('String', str, 'First done callback argument is string');
	            		ASSERT.areEqual(123, num, 'Second done callback argument is number');
	            		
	            	}).fail(function (str, num) {
	            		fail++;
	            	});
	            	
	            	done = 0;
	            	fail = 0;
	            	
	            	deferred.resolve(['String', 123]);
	            	
	            	ASSERT.areEqual(1, done, 'Done callback was called once');
	            	ASSERT.areEqual(0, fail, 'Fail callback was not called');
	            	
	            },
	            
	            testReject: function () {
	            	
	            	var deferred = Supra.Deferred(),
	            		done = 100,
	            		fail = 100;
	            	
	            	deferred.done(function (str, num) {
	            		done++;
	            	}).fail(function (str, num) {
	            		fail++;
	            		
	            		ASSERT.areEqual('String', str, 'First done callback argument is string');
	            		ASSERT.areEqual(123, num, 'Second done callback argument is number');
	            	});
	            	
	            	done = 0;
	            	fail = 0;
	            	
	            	deferred.reject(['String', 123]);
	            	
	            	ASSERT.areEqual(0, done, 'Done callback was not called');
	            	ASSERT.areEqual(1, fail, 'Fail callback was called once');
	            	
	            },
	            
	            testAlways: function () {
	            	
	            	var deferred = Supra.Deferred(),
	            		done = 100,
	            		fail = 100;
	            	
	            	deferred.always(function (str, num) {
	            		done++;
	            		fail++;
	            	});
	            	
	            	deferred.reject(['String', 123]);
	            	
	            	ASSERT.areEqual(101, done, 'Done callback was called once');
	            	ASSERT.areEqual(101, fail, 'Fail callback was called once');
	            	
	            },
	            
	            testDoneAfterResolve: function () {
	            	
	            	var deferred = Supra.Deferred(),
	            		done = 100,
	            		fail = 100;
	            	
	            	deferred.done(function () {
	            		done++;
	            	});
	            	
	            	deferred.resolve();
	            	
	            	ASSERT.areEqual(101, done, 'Done callback was called');
	            	
	            	deferred.done(function () {
	            		done++;
	            	});
	            	deferred.always(function () {
	            		done++;
	            	});
	            	
	            	
	            	ASSERT.areEqual(103, done, 'Done callbacks were called immediatelly after resolve');
	            	
	            	deferred.resolve();
	            	
	            	ASSERT.areEqual(103, done, 'Done callbacks were not called again on repeated resolve call');
	            },
	            
	            testPromise: function () {
	            	
	            	var deferred = window.deferred = Supra.Deferred(),
	            		promise = window.promise = deferred.promise(),
	            		done = 100,
	            		fail = 100;
	            	
	            	promise.done(function (str, num) {
	            		done++;
	            		
	            		ASSERT.areEqual('String', str, 'First done callback argument is string');
	            		ASSERT.areEqual(123, num, 'Second done callback argument is number');
	            		
	            	}).fail(function (str, num) {
	            		fail++;
	            	});
	            	
	            	done = 0;
	            	fail = 0;
	            	
	            	deferred.resolve(['String', 123]);
	            	
	            	ASSERT.areEqual(1, done, 'Done callback was called once');
	            	ASSERT.areEqual(0, fail, 'Fail callback was not called');
	            	
	            }
	            
	            
			});
			
			var console = new Y.Console({'height': '92%', 'width': '70%'}).render();
			
	        Y.Test.Runner.add(testBasic);
	        Y.Test.Runner.run();
		});
		
	//]]>
	</script>
	
</body>
</html>
