<!DOCTYPE html>
<html>
<head>
	<title>YUI 3 migration test</title>
	
	<!-- Load all base (YUI, Loader, Supra) JS files at once -->
	<script src="/cms/lib/supra/combo/combo.php?/cms/lib/yui.3.5.0/build/yui/yui-min.js&amp;/cms/lib/yui.3.5.0/build/loader/loader-min.js&amp;/cms/lib/supra/build/supra/supra.js&amp;/cms/lib/supra/build/supra/data.js&amp;/cms/lib/supra/build/supra/modules.js"></script>
	
	<!-- Load all base CSS files at once -->
	<link rel="stylesheet" type="text/css" href="/cms/lib/supra/combo/combo.php?/cms/lib/yui.3.5.0/build/cssreset/reset.css&amp;/cms/lib/supra/build/supra/reset.css" />
	
</head>
<body class="yui3-skin-supra">

	<div class="cms-header" id="cmsHeader"></div>
	<div class="cms-content" id="cmsContent"></div>

	<script type="text/javascript">
	//<![CDATA[
	
		function Modules () {
			
			console.log('> all base modules loading...');
		
			Supra(function () {
				
				console.log('    done!');
				console.log('-----------------------------');
				
				var modules = Supra.mix({}, Supra.YUI_BASE.groups.supra.modules),
					arr = [];
				
				for(var i in modules) {
					modules[i]._id = i;
					arr.push(modules[i]);
				}
				
				var i = 0,
					ii = arr.length;
				
				function next () {
					var item = arr.shift();
					if (!item) {
						console.log('-----------------------------');
						console.log('Finished loading all modules!');
						
						Actions();
						
						return;
					}
					
					item = item._id;
					console.log('> ' + item + ' loading...');
					
					Supra(item, function () {
						console.log('    done!');
						next();
					});
				}
				
				next();
				
			});
			
		}
		
		function Actions () {
			
			var APP_PATH = '/lib/supra/tests/yui-migration',
				STATIC_PATH = '/cms',
				DYNAMIC_PATH = '/cms';
			
			Supra.data.set({
				//Application
				'application': {
					'id': 'test',
					'path': STATIC_PATH + APP_PATH,
					'icon': '/cms/lib/supra/img/apps/test',
					'title': 'Test'
				}
			});
			
			//Set current manager paths
			Supra.Manager.Loader.setStaticPath(STATIC_PATH);
			Supra.Manager.Loader.setDynamicPath(DYNAMIC_PATH);
			
			var list = ['Header', 'LayoutContainers', 'PageToolbar', 'PageButtons'],
				count = list.length,
				loaded = 0;
			
			console.log('> Load actions "' + list.join('", "') + '"');
			
			Supra.Y.each(list, function (action) {
				Supra.Y.on('exist', function () {
					console.log('    done "' + action + '"');
					loaded++;
					if (loaded == count) ready();
				}, 'Supra.Manager.' + action);
			})
			
			Supra.Manager.loadActions(list);
			
			function ready () {
				Supra.Manager.executeAction('Header');
				Supra.Manager.executeAction('PageToolbar');
				Supra.Manager.executeAction('PageButtons');
				
				console.log('    done all actions');
			}
		}
		
		Modules();
		
	//]]>
	</script>
	
</body>
</html>
