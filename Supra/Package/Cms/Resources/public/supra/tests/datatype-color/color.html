<!DOCTYPE html>
<html>
<head>
	<title>Input Color test</title>
	
	<!-- Load all base (YUI, Loader, Supra) JS files at once -->
	<script src="/cms/lib/supra/combo/combo.php?/cms/lib/yui.3.5.0/build/yui/yui-min.js&amp;/cms/lib/yui.3.5.0/build/loader/loader-min.js&amp;/cms/lib/supra/build/supra/supra.js&amp;/cms/lib/supra/build/supra/data.js&amp;/cms/lib/supra/build/supra/modules.js"></script>
	
	<!-- Load all base CSS files at once -->
	<link rel="stylesheet" type="text/css" href="/cms/lib/supra/combo/combo.php?/cms/lib/yui.3.5.0/build/cssreset/reset.css&amp;/cms/lib/supra/build/supra/reset.css" />
	
	<link rel="stylesheet" type="text/css" href="color.css" />
</head>
<body class="yui3-skin-supra">

	<div class="cms-content" id="cmsContent">
		
		<div class="ui-dark ui-dark-background">
			
			<div class="magic-content yui3-form yui3-form-vertical"></div>
			
		</div>
		
		<div class="ui-dark ui-dark-2 ui-dark-background">
			<div class="yui3-form">
				
				<p class="label">Normal</p>
				<div id="outputNormal" class="output"></div>
				
				<p class="label">Add</p>
				<div id="outputAdd" class="output"></div>
				
				<p class="label">Overlay</p>
				<div id="outputOverlay" class="output"></div>
			
			</div>
		</div>
		
	</div>

	<script type="text/javascript">
	//<![CDATA[
	
		Supra('supra.manager', function (Y) {
			
			var APP_PATH = null,
				STATIC_PATH = '/cms',
				DYNAMIC_PATH = '/cms';
			
			//Set current manager paths
			Supra.Manager.Loader.setStaticPath(STATIC_PATH);
			Supra.Manager.Loader.setDynamicPath(DYNAMIC_PATH);
			
			var layout = Supra.Manager.getAction('LayoutContainers');
			
			layout.on('execute', function () {
				
				Supra('supra.datatype-color', 'supra.form', function () {
					var Color = Y.DataType.Color;
					
					//AAaaaaa
					var testChange = Y.one(".test-set"),
						testDrag = Y.one(".test-drag");
					
					var colorA = window.colorA = new Supra.Input.Color({
						"label": "Color A",
						"value": "#A4A4A4"
					});
					
					var colorB = window.colorB = new Supra.Input.Color({
						"label": "Color B",
						'value': "#6D6D6D"
					});
					
					var colorBase = window.colorBase = new Supra.Input.Color({
						"label": "Base color",
						"value": "#FFAE00"
					});
					
					colorA.render(Y.one('.magic-content'));
					colorB.render(Y.one('.magic-content'));
					colorBase.render(Y.one('.magic-content'));
					
					colorA.on(["valueChange", "colorChange"], function (e) {
						update(e.newVal, colorB.get('value'), colorBase.get('value'));
					});
					
					colorB.on(["valueChange", "colorChange"], function (e) {
						update(colorA.get('value'), e.newVal, colorBase.get('value'));
					});
					
					colorBase.on(["valueChange", "colorChange"], function (e) {
						update(colorA.get('value'), colorB.get('value'), e.newVal);
					});
					
					function update (colorA, colorB, colorBase) {
						renderGradient(colorA, colorB, '#outputNormal');
						
						//Add
						var outA = Color.format(Color.math.add(colorA, colorBase)),
							outB = Color.format(Color.math.add(colorB, colorBase));
						
						renderGradient(outA, outB, '#outputAdd');
						
						//Overlay
						var outA = Color.format(Color.math.overlay(colorA, colorBase)),
							outB = Color.format(Color.math.overlay(colorB, colorBase));
						
						renderGradient(outA, outB, '#outputOverlay');
						
						var hsb = Color.convert.HEXtoHSB(colorBase);
						console.log('hue: ', hsb.hue, 'saturation: ', hsb.saturation);
					}
					
					function renderGradient(from, to, node) {
						from = Color.format(from);
						to = Color.format(to);
						node = Y.one(node);
						
						var prop = (Y.UA.webkit ? '-webkit-' : (Y.UA.gecko ? '-moz-' : (Y.UA.ie ? '-ms-' : '')));
						node.setStyle('backgroundImage', prop + 'linear-gradient(top, ' + from + ' 0%, ' + to + ' 100%)');
					}
					
					update(colorA.get('value'), colorB.get('value'), colorBase.get('value'));
				
				})
				
			});
			
			layout.execute();
			
		});
		
	//]]>
	</script>
	
</body>
</html>
